<!DOCTYPE html>
<html lang="pt-BR" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindScan® | Avaliação Psicoprofissional</title>
    <style>
        :root[data-theme="light"] { --bg: #F8F6F0; --card: #ffffff; --text: #1A3A5A; --gold: #C5A065; --border: #ddd; --input-bg: #fff; }
        :root[data-theme="dark"] { --bg: #121212; --card: #1E1E1E; --text: #E0E0E0; --gold: #D4AF37; --border: #333; --input-bg: #2c2c2c; }
        
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; transition: 0.3s; padding-bottom: 50px; }
        .header { background: #1A3A5A; padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; position: sticky; top:0; z-index: 100; }
        .logo-syn { height: 45px; }
        .theme-toggle { background: none; border: 1px solid var(--gold); color: var(--gold); padding: 8px 15px; border-radius: 20px; cursor: pointer; }
        
        .container { max-width: 900px; margin: 40px auto; padding: 0 20px; }
        .intro-card { background: var(--card); padding: 30px; border-radius: 15px; border-left: 5px solid var(--gold); box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 30px; }
        
        .user-info { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        input { padding: 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--input-bg); color: var(--text); font-size: 16px; }
        
        .question-card { background: var(--card); padding: 25px; border-radius: 12px; margin-bottom: 20px; border: 1px solid var(--border); }
        .question-text { font-size: 18px; font-weight: 500; display: block; margin-bottom: 15px; }
        
        .scale-options { display: flex; justify-content: space-between; gap: 10px; }
        .scale-item { flex: 1; text-align: center; cursor: pointer; }
        .scale-item input { display: none; }
        .scale-num { display: block; padding: 10px; border: 1px solid var(--border); border-radius: 8px; transition: 0.2s; font-weight: bold; }
        .scale-item input:checked + .scale-num { background: var(--gold); color: white; border-color: var(--gold); }
        .scale-label { font-size: 11px; margin-top: 5px; display: block; opacity: 0.8; }
        
        .submit-btn { background: var(--gold); color: white; border: none; padding: 20px 50px; border-radius: 30px; font-size: 20px; font-weight: bold; cursor: pointer; width: 100%; transition: 0.3s; margin-top: 30px; }
        .submit-btn:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(197,160,101,0.4); }
        .submit-btn:disabled { background: #ccc; cursor: not-allowed; }
    </style>
</head>
<body>
    <header class="header">
        <img src="/static/synmind_logo.jpg" alt="SynMind" class="logo-syn">
        <button class="theme-toggle" onclick="toggleTheme()">ALTERAR TEMA</button>
    </header>

    <div class="container">
        <div class="intro-card">
            <h2>Avaliação MindScan® V4</h2>
            <p>Responda às questões abaixo com sinceridade. Não existem respostas certas ou erradas.</p>
        </div>

        <form id="mindscanForm">
            <div class="user-info">
                <input type="text" id="name" placeholder="Nome Completo" required>
                <input type="email" id="email" placeholder="E-mail Profissional" required>
            </div>

            <div id="questionsContainer">
                </div>

            <button type="submit" id="submitBtn" class="submit-btn">FINALIZAR AVALIAÇÃO</button>
        </form>
    </div>

    <script>
        function toggleTheme() {
            const html = document.documentElement;
            html.setAttribute('data-theme', html.getAttribute('data-theme') === 'light' ? 'dark' : 'light');
        }

        const questions = [
            "Sou uma pessoa que se preocupa muito.", "Faço amigos facilmente.", "Tenho uma imaginação fértil.",
            "Confio nos outros.", "Sou uma pessoa organizada.", "Fico estressado facilmente.",
            "Gosto de festas lotadas.", "Amo a arte.", "Acredito que os outros têm boas intenções.",
            "Frequentemente esqueço de colocar as coisas no lugar.", "Fico irritado facilmente.",
            "Tomo o controle das situações.", "Gosto de ler sobre temas variados.", "Sou prestativo com os outros.",
            "Mantenho minhas promessas.", "Sinto-me triste com frequência.", "Sou uma pessoa entusiasmada.",
            "Tenho um vocabulário rico.", "Sinto compaixão por quem sofre.", "Sou uma pessoa trabalhadora.",
            "Sinto-me sobrecarregado pelas obrigações.", "Falo muito.", "Entendo as coisas rapidamente.",
            "Sou atencioso com os sentimentos alheios.", "Mantenho meus pertences limpos.",
            "Tenho medo de muitas coisas.", "Evito ser o centro das atenções.", "Sou bom em entender ideias abstratas.",
            "Trato os outros com respeito.", "Faço as coisas imediatamente.", "Fico desanimado facilmente.",
            "Estou sempre cheio de energia.", "Uso palavras difíceis.", "Penso primeiro em mim antes dos outros.",
            "Gosto de seguir uma rotina.", "Mudo de humor frequentemente.", "Sou muito ativo.",
            "Gosto de filosofar.", "Perdoo facilmente.", "Trabalho muito para atingir meus objetivos.",
            "Tenho pânico de falhar.", "Sou uma pessoa divertida.", "Aprecio a beleza do mundo.",
            "Acredito no que os outros dizem.", "Termino tudo o que começo.", "Fico nervoso perto de estranhos.",
            "Sou o centro das festas.", "Tenho muitos interesses.", "Sinto o que os outros sentem.",
            "Sigo os planos que faço.", "Senti dificuldade em me acalmar.", "Senti a boca seca.",
            "Não consegui sentir nenhum sentimento positivo.", "Tive dificuldade em respirar.",
            "Senti dificuldade em tomar iniciativa para fazer as coisas.", "Tive tendência a reagir exageradamente às situações.",
            "Senti tremores (por ex. nas mãos).", "Senti que estava usando muita energia nervosa.",
            "Preocupei-me com situações em que poderia entrar em pânico.", "Senti que não tinha nada por que esperar.",
            "Senti que ficava agitado facilmente.", "Senti que era difícil relaxar.", "Senti-me deprimido e sem ânimo.",
            "Fui intolerante com qualquer coisa que me impedisse de continuar o que estava fazendo.",
            "Senti que estava prestes a entrar em pânico.", "Fui incapaz de me entusiasmar com qualquer coisa.",
            "Senti que não tinha muito valor como pessoa.", "Senti que era um pouco sensível demais.",
            "Tive consciência dos batimentos cardíacos mesmo sem esforço físico.", "Senti medo sem motivo.",
            "Senti que a vida não tinha sentido."
        ];

        const labels = ["Discordo Totalmente", "Discordo", "Neutro", "Concordo", "Concordo Muito", "Concordo Totalmente"];
        const container = document.getElementById('questionsContainer');

        questions.forEach((q, i) => {
            const div = document.createElement('div');
            div.className = 'question-card';
            div.innerHTML = `
                <span class="question-text">${i+1}. ${q}</span>
                <div class="scale-options">
                    ${[1,2,3,4,5,6].map(n => `
                        <label class="scale-item">
                            <input type="radio" name="q${i}" value="${n}" required>
                            <span class="scale-num">${n}</span>
                            <span class="scale-label">${labels[n-1]}</span>
                        </label>
                    `).join('')}
                </div>`;
            container.appendChild(div);
        });

        document.getElementById('mindscanForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            btn.disabled = true; 
            btn.textContent = "PROCESSANDO...";
            
            const resps = questions.map((_, i) => {
                const checked = document.querySelector(`input[name="q${i}"]:checked`);
                return checked ? parseInt(checked.value) : 0;
            });
            
            try {
                const response = await fetch('/api/v1/submit-assessment', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        user_id: document.getElementById('email').value,
                        name: document.getElementById('name').value,
                        big5_responses: resps.slice(0, 50),
                        dass21_responses: resps.slice(50, 71)
                    })
                });

                if (response.ok) {
                    window.location.href = "/admin";
                } else {
                    const errorData = await response.json();
                    alert("Erro ao salvar: " + (errorData.detail || "Erro desconhecido"));
                    btn.disabled = false;
                    btn.textContent = "FINALIZAR AVALIAÇÃO";
                }
            } catch (error) {
                console.error("Erro na requisição:", error);
                alert("Erro de conexão com o servidor.");
                btn.disabled = false;
                btn.textContent = "FINALIZAR AVALIAÇÃO";
            }
        });
    </script>
</body>
</html>